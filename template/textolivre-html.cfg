\Preamble{xhtml}

% remove angle brakets from urls in bibliography
\DeclareFieldFormat{url}{\bibstring{urlfrom}\addcolon\addspace\url{#1}}%

% Redefines \rotatebox to just print the text, without any rotation.
\renewcommand\rotatebox[3][]{#3}
\Css{\#TBL-1 \#TBL-1-5g{border:none;}}
\Css{\#TBL-1 \#TBL-1-1g{border:none;}}

% Graphics scaling 
\makeatletter
\ExplSyntaxOn
\Configure{Gin-dim}{style="width:\fp_eval:n{round(\Gin@req@width/\textwidth*80,2)}\%"}
\ExplSyntaxOff
\makeatother

% prevent make4ht from creating unnecessary span sibling tags in abstract
\ConfigureEnv{abstract}
{\ifvmode\IgnorePar\fi\EndP\HCode{<section role="doc-abstract" class="abstract">\Hnewline}
\ConfigureEnv{center}{\ifvmode\IgnorePar\fi\EndP\HCode{<h3 class="abstracttitle">}\HtmlParOff}{\HCode{</h3>}\HtmlParOn\par\normalsize\normalfont}{\empty}{\empty}
} 
{\ifvmode\IgnorePar\fi\EndP\HCode{</section>}}{}{}
\Css{.abstract{font-size:0.9rem;margin-bottom:1em;}}
\Css{.abstracttitle{text-align:center;}}

% activate emoticons
\xeuniuseblock{Emoticons}

\begin{document}

% Removing div element surrounding tables and figures.
\ConfigureEnv{tabular}
    {\HCode{}}{\HCode{}}{}{}
\ConfigureEnv{figure} 
    {\HCode{}}{\HCode{}}{}{}
    
% Convert tables into images.
%\ConfigureEnv{table}
%    {\Picture*{}}{\EndPicture}{}{}

% Always ignore \hline commands. Tables will rather be styled using CSS.
\Configure{hline}{\HCode{}}
% This one removes the rulers. Taking a look at html4.4ht should make 
% clear what has been changed.
\Configure{float}
   {\ifOption{refcaption}{}{\csname par\endcsname\ShowPar \leavevmode}}
   {\HCode{}}
{\ifvmode \IgnorePar \fi\EndP \HCode{}\csname par\endcsname\ShowPar}

\EndPreamble
